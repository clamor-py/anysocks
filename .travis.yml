language: python
sudo: false
cache: pip

python:
  - "3.5"
  - "3.6"

matrix:
  include:
    # Python 3.7 workaround
    - python: 3.7.3
      dist: xenial
      sudo: true

install:
  - pip install -U pylama
  - pip install -U coverage
  - pip install -e .
  - pip install -U -r .readthedocs/requirements.txt

script:
  # Linting
  - pylama .

  # Coverage & unit tests
  - coverage run setup.py test
  - coverage combine
  - coverage report -i

  # Build docs
  - make -C docs html

before_deploy:
  # Junk generated by setup.py test
  - rm -rf *.egg-info

deploy:
  provider: pypi
  user: "vbe0201"
  password: $PYPI_PASSWORD
  skip_existing: true
  on:
    tags: true

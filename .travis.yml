language: python
sudo: false
cache: pip

python:
  - "3.5"
  - "3.6"

matrix:
  include:
    # Python 3.7 workaround
    - python: 3.7.3
      dist: xenial
      sudo: true

install:
  - pip install -U pylama
  - pip install -U coverage
  - pip install -e .
  - pip install -U -r .readthedocs/requirements.txt

script:
  # Linting
  - pylama .

  # Coverage & unit tests
  - coverage run setup.py test
  - coverage combine
  - coverage report -i

  # Build docs
  - make -C docs html

before_deploy:
  # Junk generated by setup.py test
  - rm -rf *.egg-info

deploy:
  provider: pypi
  user: "vbe0201"
  password:
    secure: "VDKkLZYWpdOorJtT6wmaDp3QWWMhWSfrD7fytTMTx8f156va+KrFW8yYFx/eOzPaATJZHBIm5eeiuvtRq7dvGkeQdWpchwbd2d04MWpiS3IhV22vlg/p4GcNmRvV9my6sGnjrVlDtbGlZBC8C5yyRZsDimUyaPQpk1Km2lxQCJnpI1cRYDas/3Qin6uqhqicP03oIM1fusL8GVMjH0JrMK68nIL1qNlACSyVD5NCrTfIdi1gDetfuPUp2AiM2RDJ6ejwYVwiGiiOpc7c6EVRC1zAglS3iyTwiNbdXE3HWuxFXE3Pe2FNGp7Om0tuWNFvGosrK+M0aDuCrHhIWkshUT6xTEd/CIf0pT0Sf90nrKxCYo2DrtEZe8Z7IEgjC0Hzz+oSqhMdr4Dr6cB+a6nJCtqhz2Iv/IPTnpE4LKEp02I3fLjFvbutr7N1Iy8a+NYyuHv8QyzvGu/Hh+gQIpm78W/mdedFIXjZG6uxbKAwj8pmE+hJyB6mfy1MPrcdxOYHRwj4ZUqYg9WF0AV32iW65Nzbyu3TzgaXHcG49X3yUrtmq2fzs5HaOs4Im4dBzo8DbHogOOTsoOzRDHDSeuA275DddW++r838mn9AOyuuW6OftaTl1QHx5WszinLr/o+pvrC9ZgAEYRLTQ88LgS3n2+2D1knkbgI3+nqq9C2Y6s8="
  skip_existing: true
  on:
    tags: true

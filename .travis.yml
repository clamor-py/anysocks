language: python
sudo: false
cache: pip

python:
  - "3.5"
  - "3.6"

matrix:
  include:
    # Python 3.7 workaround
    - python: 3.7.3
      dist: xenial
      sudo: true

install:
  - pip install -U pylama
  - pip install -U coverage
  - pip install -e .
  - pip install -U -r .readthedocs/requirements.txt

script:
  # Linting
  - pylama .

  # Coverage & unit tests
  - coverage run setup.py test
  - coverage combine
  - coverage report -i

  # Build docs
  - make -C docs html

before_deploy:
  # Junk generated by setup.py test
  - rm -rf *.egg-info

deploy:
  provider: pypi
  user: "vbe0201"
  password:
    secure: "FEmuLIOJILYZK2Y5nebmdmxMOpfXEApgyjeYkdYknI3jqErW+JkPk0KyMAhX3AiunqXsuipZrrjdP0LOsXKMkcTkiGnZV5rpnYEEsXBW1eclQGSWgMy34+FtCpXJW9bQvqTQuYkX/+rj5Q0jCJCDiTgxKFcot38FAEuBYCLjnH+UT6dEPzCdd7j0GyyzameLffarndbErEJ7AXUTnfu/0UsApqRVq4Ckdid6xJG3+I5x8PBSUT00ipPtWmQNnBJh4hnTK4gWBzG6lIncKLCi9SF4FCL1gILqGkRsG4atu7mFO3aC6Tvi5PW2G4rrSRN6g/f5rNbN7Rird8QfvFjcv7jcNYUhcJLdzYwQ/LPZ7UTrKxrUz4EFGKSD0Z3Q2cWqRydhoPptFRoELZVhUu+2wJWRK25RLo8JJ8qcY3UnAtKoUnc7lK505dLY/9gASXZ/ZJCJF19ms95UxmdClFLXkUttbmU0NR83QEz9HyZPidRy1joTVfQKsvELavSbo0ZFft862WAcyOa7UldxZDRHkLKs1cJUa1Z9zRRPLezm271rb8m727k2jbXqWQsCsxr8v2VfalmHT/r7z4Ut/LvYzPQwxlCvpyqd7ZplRMrT1oHRy7V/aNlfseDJ4o1cjYhKWvH+IZaqYN7EbXvDLDY5a51fNa1RAJ59U0pB1BPhT4w="
  skip_existing: true
  on:
    tags: true
